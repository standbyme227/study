# RDS 시작하기

## RDS 란????

> Relational Database Service로  
관계형 데이터베이스를 위한 서버를 제공함으로써  
관리 및 보안에 용이하게 하는 서비스 인걸로 알고있다.

## 어떻게 시작하는가?

> 일단 준비물은 AWS계정만 있으면 3분이면 처리가 가능하다.  
물론 이게 맞는지 틀린지 고민하고 고심하는 시간이있지만  
처리하는 시간만 따졌을때는  3~5분정도이면 충분하다.

### RDS 페이지에 들어가기
> 가장 먼저 AWS콘솔창에 들어가게되면(로그인 후)  
어떤 서비스를 사용할건지를 고를 수 있다.  
물론 여기에서 **RDS** 를 선택하면된다.

### DB 인스턴스를 시작하자.
> 왼쪽 바에서든 지금 화면에서든 인스턴스에 관련된 부분을 찾아서  
**DB인스턴스** 시작을 클릭하면 된다.

### DB 인스턴스 생성과정~
1. 엔진옵션을 선택한다.(아래쪽에 호환성을 체크하는 부분도 있다.)
    - **프리티어**를 사용한다면 맨아래왼쪽의 체크박스를 체크하자.
    - 프리티어는 **Aurora**를 사용할 수 없다.  
</br>
2. DB 세부정보를 지정하자.
    - 라이센스 모델, DB 엔진버젼 등 여러가지를 알맞게 설정한다.
    - **다중 AZ배포** 에 대해서는 좀 더 공부하자.  
</br>
3. DB를 설정하자(전과 같은 페이지)
    - DB인스턴스 식별자  
    (DB인스턴스는 각각의 고유한 이름을 갖는다.)
    - 마스터 사용자 이름, 비밀번호 설정  
</br>
4. DB에 대해 고급설정을 구현하자.
    - 네트워크 및 보안  
      - 다른 부분을 제외하고 **퍼블릭 액세스 가능성** 과 **보안그룹** 을 신경쓰자.
      - 퍼블릭 액세스는 접근자체를 허용하겠다는 거니  
      허용을 한다면 **보안성** 은 조금 떨어진다고 보면 되겠다.  
      (허용을 하지않는다면 AWS내에서만 접근이 가능하다고 보면된다.)
      - **보안그룹** 에 대해서도 보강해야겠다.(잘 모름)
      - 데이터 베이스 옵션, 암호화 등 몇몇 부분이 있지만  
      최소한의 설정에선 손을 대지 않아도 된다.  
</br>
5. DB 인스턴스 시작을 누른다.
    - 생성하는데 시간이 조금 소요된다.


### Django의 settings에서 database부분 변경.
```
# DATABASES = {
#     'default': {
#         'ENGINE': '사용하는 엔진',
#         'NAME': 'DB의 이름',  # Name of database instance
#         'HOST': 'api.algorithmlabs.io',
#         'PORT': 포트번호,
#         'USER': '유저네임',
#         'PASSWORD': '비밀번호',
#     }
# }
```  
```
DATABASES = {
  'default': {
      'ENGINE': '사용하는 엔진',
      'NAME': 'DB의 이름',  # Name of database instance
      'HOST': 'AWS RDS의 엔드포인트',
      'PORT': 포트번호,
      'USER': 'AWS RDS의 유저네임',
      'PASSWORD': 'AWS RDS의 비밀번호',
      'OPTIONS': {
          'init_command': "SET sql_mode='STRICT_TRANS_TABLES'",
          'charset': 'utf8mb4',
      }
  }
}
```

> 위에 주석처리된 부분이 기존 것.  
아래 작성된 부분이 새로운 DB setting이다.  
크게 달라졌다기 보다는 **AWS에 맞춰서 설정** 을 했을뿐이고,

>가장 아래의 **OPTIONS** 부분은  
migrate 후 뜨는 error메세지를 방지하기 위한 처리다.


### Django runserver로 테스트해보다.

> 실행을 하면 항상 뜨는 '첫 줄' 빼고는  
아무런 움직임이 없다가,  
**OperationalError** 가 뜬다면 성공이다.

> 아까 우리가 RDS DB인스턴스를 생성할때  
**보안그룹** 이란것을 슬쩍 설정했었는데  
인스턴스에서 보안그룹을 따라보면 인/아웃바운드에 어느 곳이든  
전혀 허용이 되지 않은 것을 확인 할 수 있다.  

>우리는 이 DB에 접근을 허용해야하기 때문에   
인바운드허용을 위한 규칙을 지정해줘야한다.  
(못찾겠다면 AWS서비스중 **EC2** 에 접근해서 보안그룹에 접근한다.)

> 규칙엔 **유형** , **프로토콜** , **포트범위** , **소스** 를 지정할 수 있는데  
유형은 현재 사용하는 DB엔진을 지정하고  
</br>
포트 범위는 그에따라서 설정이되지만 혹시나 스스로해야한다면  
각 DB엔진에 맞는 포트를 지정한다.  
(django 세팅과 맞추면 아무포트나 되는지는 확인 안해봤다.)  
</br>
프로토콜은 따로 지정할 필요가 없고  
소스는 내 ip만 허용하면 DB접근에 대한 규칙설정이 끝난다.

### 다시 한번 runserver!!!!!!

> 물론 **migration** 에 관한 오류가 뜰것이다.  
현재 우리는 DB를 연결했을뿐, col과 row를 손보지 않았기 때문에  
</br>
완벽하게 연동하려면 migrate를 완성시키고  
Data를 **Import** 하면된다.
